{\rtf1\ansi\ansicpg1251\cocoartf2709
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;\f1\fnil\fcharset0 LucidaGrande;}
{\colortbl;\red255\green255\blue255;\red0\green0\blue0;}
{\*\expandedcolortbl;;\cssrgb\c0\c0\c0;}
\paperw11905\paperh16837\margl1133\margr1133\margb1133\margt1133
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs22 \cf2 \up0 \nosupersub \ulnone <!DOCTYPE html>\
<html lang="en">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>3D Model Viewer PRO</title>\
    <style>\
        * \{\
            margin: 0;\
            padding: 0;\
            box-sizing: border-box;\
        \}\
        body \{\
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);\
            color: #fff;\
            min-height: 100vh;\
            display: flex;\
            flex-direction: column;\
            align-items: center;\
            padding: 20px;\
            overflow-x: hidden;\
        \}\
        .container \{\
            width: 100%;\
            max-width: 1200px;\
            display: flex;\
            flex-direction: column;\
            align-items: center;\
            gap: 20px;\
        \}\
        header \{\
            text-align: center;\
            padding: 20px;\
            width: 100%;\
        \}\
        h1 \{\
            font-size: 2.5rem;\
            margin-bottom: 10px;\
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\
        \}\
        .subtitle \{\
            font-size: 1.2rem;\
            opacity: 0.9;\
        \}\
        .viewer-container \{\
            width: 100%;\
            display: flex;\
            flex-wrap: wrap;\
            gap: 20px;\
            justify-content: center;\
        \}\
        #canvas-container \{\
            flex: 1;\
            min-width: 300px;\
            height: 500px;\
            border-radius: 10px;\
            overflow: hidden;\
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);\
            position: relative;\
            background: #1a1a1a;\
        \}\
        #canvas \{\
            width: 100%;\
            height: 100%;\
            display: block;\
        \}\
        #controls \{\
            background: rgba(30, 30, 40, 0.8);\
            backdrop-filter: blur(10px);\
            padding: 20px;\
            border-radius: 10px;\
            width: 300px;\
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);\
            max-height: 500px;\
            overflow-y: auto;\
        \}\
        .control-group \{\
            margin-bottom: 20px;\
        \}\
        .control-group h3 \{\
            margin-bottom: 10px;\
            color: #ff9d00;\
            border-bottom: 1px solid #444;\
            padding-bottom: 5px;\
        \}\
        button \{\
            background: #4361ee;\
            color: white;\
            border: none;\
            padding: 10px 15px;\
            margin: 5px;\
            border-radius: 5px;\
            cursor: pointer;\
            transition: all 0.3s;\
            width: calc(100% - 10px);\
            font-weight: 500;\
        \}\
        button:hover \{\
            background: #3a56d4;\
            transform: translateY(-2px);\
        \}\
        .material-btn \{\
            background: #f72585;\
        \}\
        .material-btn:hover \{\
            background: #d9047c;\
        \}\
        .screenshot-btn \{\
            background: #4cc9f0;\
            color: #000;\
        \}\
        .screenshot-btn:hover \{\
            background: #3aa8d0;\
        \}\
        .file-input-container \{\
            margin: 10px 5px;\
        \}\
        .file-input-label \{\
            display: block;\
            background: #7209b7;\
            color: white;\
            padding: 10px 15px;\
            border-radius: 5px;\
            cursor: pointer;\
            text-align: center;\
            transition: all 0.3s;\
        \}\
        .file-input-label:hover \{\
            background: #5a08a0;\
            transform: translateY(-2px);\
        \}\
        input[type="file"] \{\
            display: none;\
        \}\
        .status \{\
            background: rgba(0, 0, 0, 0.3);\
            padding: 15px;\
            border-radius: 8px;\
            margin-top: 15px;\
            text-align: center;\
            font-size: 14px;\
        \}\
        .loading \{\
            position: absolute;\
            top: 50%;\
            left: 50%;\
            transform: translate(-50%, -50%);\
            background: rgba(0, 0, 0, 0.8);\
            padding: 20px 30px;\
            border-radius: 10px;\
            text-align: center;\
            display: none;\
            z-index: 100;\
        \}\
        .color-control \{\
            display: flex;\
            align-items: center;\
            margin: 10px 5px;\
            gap: 10px;\
        \}\
        .color-control label \{\
            flex: 1;\
        \}\
        .color-control input \{\
            width: 60px;\
            height: 40px;\
            border: none;\
            border-radius: 5px;\
            cursor: pointer;\
        \}\
        .rotation-control \{\
            display: flex;\
            align-items: center;\
            margin: 10px 5px;\
            gap: 10px;\
        \}\
        .rotation-control label \{\
            flex: 1;\
        \}\
        .rotation-control input \{\
            flex: 2;\
        \}\
        .material-control \{\
            display: grid;\
            grid-template-columns: 1fr 1fr;\
            gap: 5px;\
            margin: 10px 5px;\
        \}\
        .material-control button \{\
            margin: 2px;\
            padding: 8px 12px;\
            font-size: 12px;\
        \}\
        .material-props \{\
            margin: 10px 5px;\
            display: none;\
        \}\
        .material-prop \{\
            display: flex;\
            align-items: center;\
            margin: 8px 0;\
            gap: 10px;\
        \}\
        .material-prop label \{\
            flex: 1;\
            font-size: 14px;\
        \}\
        .material-prop input \{\
            flex: 2;\
        \}\
        .direction-control \{\
            display: flex;\
            gap: 5px;\
        \}\
        .direction-control button \{\
            flex: 1;\
        \}\
        .format-info \{\
            font-size: 12px;\
            opacity: 0.7;\
            margin-top: 5px;\
            text-align: center;\
        \}\
        \
        .url-input-container \{\
            margin: 10px 5px;\
        \}\
        .url-input \{\
            width: 100%;\
            padding: 10px;\
            border-radius: 5px;\
            border: 1px solid #555;\
            background: rgba(30, 30, 40, 0.8);\
            color: white;\
            margin-bottom: 5px;\
        \}\
        .share-section \{\
            background: rgba(40, 40, 50, 0.7);\
            padding: 15px;\
            border-radius: 8px;\
            margin-top: 10px;\
        \}\
        .share-url \{\
            background: rgba(20, 20, 30, 0.9);\
            padding: 10px;\
            border-radius: 5px;\
            word-break: break-all;\
            font-size: 12px;\
            margin: 10px 0;\
            border: 1px solid #555;\
        \}\
        .share-buttons \{\
            display: flex;\
            gap: 5px;\
        \}\
        .share-buttons button \{\
            flex: 1;\
            padding: 8px;\
            font-size: 12px;\
        \}\
        \
        .upload-instructions \{\
            background: rgba(40, 40, 50, 0.7);\
            padding: 15px;\
            border-radius: 8px;\
            margin-top: 10px;\
            font-size: 14px;\
        \}\
        .upload-instructions h4 \{\
            color: #ff9d00;\
            margin-bottom: 10px;\
        \}\
        .upload-instructions ol \{\
            padding-left: 20px;\
            margin-bottom: 10px;\
        \}\
        .upload-instructions li \{\
            margin-bottom: 8px;\
        \}\
        .upload-instructions a \{\
            color: #4cc9f0;\
            text-decoration: none;\
        \}\
        .upload-instructions a:hover \{\
            text-decoration: underline;\
        \}\
        \
        /* Client mode styles */\
        .client-mode .file-input-container,\
        .client-mode .url-input-container,\
        .client-mode #test-model,\
        .client-mode .share-section,\
        .client-mode .upload-instructions \{\
            display: none !important;\
        \}\
        \
        .client-mode .control-group:first-child \{\
            display: none !important;\
        \}\
        \
        @media (max-width: 768px) \{\
            .viewer-container \{\
                flex-direction: column;\
                align-items: center;\
            \}\
            #controls \{\
                width: 100%;\
                max-width: 300px;\
            \}\
        \}\
    </style>\
</head>\
<body>\
    <div class="container">\
        <header>\
            <h1>3D Model Viewer PRO</h1>\
            <p class="subtitle">Professional 3D model viewer - Share models via URL</p>\
        </header>\
\
        <div class="viewer-container">\
            <div id="canvas-container">\
                <canvas id="canvas"></canvas>\
                <div class="loading" id="loading">\
                    <h3>Loading Model...</h3>\
                    <div id="progress">0%</div>\
                </div>\
            </div>\
\
            <div id="controls">\
                <!-- This section will be hidden in client mode -->\
                <div class="control-group">\
                    <h3>Load Model</h3>\
                    <div class="file-input-container">\
                        <label for="file-input" class="file-input-label">\
                            Load Local File (Preview Only)\
                        </label>\
                        <input type="file" id="file-input" accept=".stl,.glb,.obj">\
                        <p class="format-info">Supports: STL, GLB, OBJ formats</p>\
                    </div>\
                    \
                    <div class="url-input-container">\
                        <input type="text" id="model-url" class="url-input" \
                               placeholder="Paste Google Drive or direct URL">\
                        <button id="load-url-model">Load from URL</button>\
                    </div>\
                    \
                    <button id="test-model" style="background: #ff6b6b;">Load Test Model</button>\
                </div>\
\
                <!-- Share section - hidden in client mode -->\
                <div class="control-group share-section">\
                    <h3>Share Model</h3>\
                    <div class="share-section">\
                        <p>Share this model with clients:</p>\
                        <div class="share-url" id="share-url">\
                            No model loaded\
                        </div>\
                        <div class="share-buttons">\
                            <button id="copy-share-url" class="screenshot-btn">Copy Share URL</button>\
                            <button id="new-share-url" class="screenshot-btn">Create New Share URL</button>\
                        </div>\
                    </div>\
                </div>\
\
                <!-- Upload instructions -->\
                <div class="control-group upload-instructions">\
                    <h4>How to Share Models with Clients</h4>\
                    <ol>\
                        <li>Upload your model to a cloud service (Google Drive, Dropbox, etc.)</li>\
                        <li>Get a shareable link (make sure it's publicly accessible)</li>\
                        <li>Paste the link in the URL field above and click "Load from URL"</li>\
                        <li>Use the "Copy Share URL" button to get the client link</li>\
                    </ol>\
                    <p><strong>Note:</strong> Local files cannot be shared directly. You must use a cloud storage service.</p>\
                </div>\
\
                <!-- These sections remain visible in both modes -->\
                <div class="control-group">\
                    <h3>Material Type</h3>\
                    <div class="material-control">\
                        <button class="material-btn" data-material="basic">Basic</button>\
                        <button class="material-btn" data-material="standard">Standard</button>\
                        <button class="material-btn" data-material="phong">Phong</button>\
                        <button class="material-btn" data-material="lambert">Lambert</button>\
                        <button class="material-btn" data-material="toon">Toon</button>\
                        <button class="material-btn" data-material="normal">Normal</button>\
                    </div>\
                    <div class="material-props" id="material-props">\
                        <div class="material-prop">\
                            <label for="metalness">Metalness:</label>\
                            <input type="range" id="metalness" min="0" max="1" step="0.1" value="0">\
                        </div>\
                        <div class="material-prop">\
                            <label for="roughness">Roughness:</label>\
                            <input type="range" id="roughness" min="0" max="1" step="0.1" value="0.5">\
                        </div>\
                        <div class="material-prop">\
                            <label for="shininess">Shininess:</label>\
                            <input type="range" id="shininess" min="0" max="100" step="1" value="30">\
                        </div>\
                    </div>\
                </div>\
\
                <div class="control-group">\
                    <h3>Model Controls</h3>\
                    <div class="color-control">\
                        <label for="model-color">Model Color:</label>\
                        <input type="color" id="model-color" value="#ff6b6b">\
                    </div>\
                    <button id="toggle-wireframe">Wireframe: Off</button>\
                    <div class="rotation-control">\
                        <label for="rotation-speed">Auto Rotation Speed:</label>\
                        <input type="range" id="rotation-speed" min="0" max="2" step="0.1" value="0.5">\
                    </div>\
                    <button id="toggle-rotation">Auto Rotation: Off</button>\
                    <div class="direction-control">\
                        <button id="rotation-direction" class="direction-btn">Rotation: CW</button>\
                    </div>\
                </div>\
\
                <div class="control-group">\
                    <h3>View Controls</h3>\
                    <button id="reset-view">Reset View</button>\
                    <button id="toggle-grid">Grid: On</button>\
                    <button id="toggle-axes">Axes: On</button>\
                </div>\
\
                <div class="control-group">\
                    <h3>Environment</h3>\
                    <button id="bg-dark">Dark BG</button>\
                    <button id="bg-light">Light BG</button>\
                    <button id="bg-gradient">Gradient BG</button>\
                </div>\
\
                <div class="control-group">\
                    <h3>Screenshot</h3>\
                    <button id="take-screenshot" class="screenshot-btn">Take Screenshot</button>\
                </div>\
\
                <div class="status" id="status">Ready to load models. Click "Load Test Model" to start.</div>\
            </div>\
        </div>\
\
        <footer>\
            <p>3D Model Viewer PRO | Share models via URL</p>\
        </footer>\
    </div>\
\
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/STLLoader.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>\
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/OBJLoader.js"></script>\
\
    <script>\
        // ==================== URL PARAMETERS SYSTEM ====================\
        \
        function getModelUrlFromParams() \{\
            const urlParams = new URLSearchParams(window.location.search);\
            return urlParams.get('model');\
        \}\
        \
        function createShareUrl(modelUrl) \{\
            const baseUrl = window.location.origin + window.location.pathname;\
            return `$\{baseUrl\}?model=$\{encodeURIComponent(modelUrl)\}`;\
        \}\
        \
        function updateShareUrlDisplay() \{\
            const shareUrlElement = document.getElementById('share-url');\
            if (currentModelFileUrl && isValidShareableUrl(currentModelFileUrl)) \{\
                const shareUrl = createShareUrl(currentModelFileUrl);\
                shareUrlElement.textContent = shareUrl;\
                shareUrlElement.style.color = '#4cc9f0';\
            \} else \{\
                shareUrlElement.textContent = 'No shareable model loaded';\
                shareUrlElement.style.color = '#ff6b6b';\
            \}\
        \}\
        \
        function isValidShareableUrl(url) \{\
            // Check if URL is shareable (not a blob URL and not a local file)\
            return !url.startsWith('blob:') && \
                   !url.startsWith('file:') && \
                   (url.startsWith('http://') || url.startsWith('https://'));\
        \}\
        \
        function copyShareUrl() \{\
            const shareUrlElement = document.getElementById('share-url');\
            const shareUrl = shareUrlElement.textContent;\
            \
            if (shareUrl !== 'No shareable model loaded') \{\
                navigator.clipboard.writeText(shareUrl).then(() => \{\
                    updateStatus('Share URL copied to clipboard!', false);\
                \}).catch(() => \{\
                    const textArea = document.createElement('textarea');\
                    textArea.value = shareUrl;\
                    document.body.appendChild(textArea);\
                    textArea.select();\
                    document.execCommand('copy');\
                    document.body.removeChild(textArea);\
                    updateStatus('Share URL copied to clipboard!', false);\
                \});\
            \} else \{\
                updateStatus('Cannot share local files. Please use a cloud storage URL.', true);\
            \}\
        \}\
        \
        function createNewShareUrl() \{\
            if (currentModelFileUrl && isValidShareableUrl(currentModelFileUrl)) \{\
                updateShareUrlDisplay();\
                copyShareUrl();\
            \} else \{\
                updateStatus('No shareable model loaded. Please load from a cloud storage URL.', true);\
            \}\
        \}\
        \
        // ==================== CLIENT MODE DETECTION ====================\
        \
        function isClientMode() \{\
            return getModelUrlFromParams() !== null;\
        \}\
        \
        function enableClientMode() \{\
            document.body.classList.add('client-mode');\
            document.querySelector('h1').textContent = '3D Model Viewer';\
            document.querySelector('.subtitle').textContent = 'View and interact with 3D models';\
        \}\
        \
        // ==================== MAIN 3D VIEWER CODE ====================\
        \
        let currentModel = null;\
        let currentModelFileUrl = null;\
        let gridVisible = true;\
        let axesVisible = true;\
        let wireframeVisible = false;\
        let autoRotation = false;\
        let rotationSpeed = 0.5;\
        let rotationDirection = 1;\
        let currentMaterials = [];\
        let currentMaterialType = 'phong';\
        let gridHelper, axesHelper;\
        \
        // Initialize Three.js scene\
        const scene = new THREE.Scene();\
        scene.background = new THREE.Color(0x2c3e50);\
        \
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);\
        camera.position.set(5, 5, 10);\
        \
        const renderer = new THREE.WebGLRenderer(\{ \
            canvas: document.getElementById('canvas'), \
            antialias: true,\
            preserveDrawingBuffer: true\
        \});\
        \
        const container = document.getElementById('canvas-container');\
        renderer.setSize(container.offsetWidth, container.offsetHeight);\
        renderer.setPixelRatio(window.devicePixelRatio);\
        \
        // Lighting\
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);\
        scene.add(ambientLight);\
        \
        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.6);\
        directionalLight1.position.set(10, 10, 10);\
        scene.add(directionalLight1);\
        \
        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);\
        directionalLight2.position.set(-10, -10, -10);\
        scene.add(directionalLight2);\
        \
        // Helpers\
        gridHelper = new THREE.GridHelper(20, 20, 0x888888, 0x444444);\
        scene.add(gridHelper);\
        \
        axesHelper = new THREE.AxesHelper(10);\
        scene.add(axesHelper);\
        \
        // Controls\
        const controls = new THREE.OrbitControls(camera, renderer.domElement);\
        controls.enableDamping = true;\
        controls.dampingFactor = 0.05;\
        \
        // Window resize\
        window.addEventListener('resize', function() \{\
            const container = document.getElementById('canvas-container');\
            camera.aspect = container.offsetWidth / container.offsetHeight;\
            camera.updateProjectionMatrix();\
            renderer.setSize(container.offsetWidth, container.offsetHeight);\
        \});\
        \
        // Utility functions\
        function updateStatus(message, isError) \{\
            const statusElement = document.getElementById('status');\
            statusElement.textContent = message;\
            statusElement.style.color = isError ? '#ff4444' : '#ffffff';\
        \}\
        \
        function showLoading(show) \{\
            document.getElementById('loading').style.display = show ? 'block' : 'none';\
        \}\
        \
        function createMaterial(type, color, wireframe) \{\
            const colorValue = color || document.getElementById('model-color').value;\
            \
            switch(type) \{\
                case 'basic':\
                    return new THREE.MeshBasicMaterial(\{ color: colorValue, wireframe: wireframe \});\
                case 'standard':\
                    return new THREE.MeshStandardMaterial(\{ \
                        color: colorValue,\
                        metalness: parseFloat(document.getElementById('metalness').value),\
                        roughness: parseFloat(document.getElementById('roughness').value),\
                        wireframe: wireframe\
                    \});\
                case 'phong':\
                    return new THREE.MeshPhongMaterial(\{ \
                        color: colorValue,\
                        specular: 0x111111,\
                        shininess: parseFloat(document.getElementById('shininess').value),\
                        wireframe: wireframe\
                    \});\
                case 'lambert':\
                    return new THREE.MeshLambertMaterial(\{ color: colorValue, wireframe: wireframe \});\
                case 'toon':\
                    return new THREE.MeshToonMaterial(\{ color: colorValue, wireframe: wireframe \});\
                case 'normal':\
                    return new THREE.MeshNormalMaterial(\{ wireframe: wireframe \});\
                default:\
                    return new THREE.MeshPhongMaterial(\{ color: colorValue, wireframe: wireframe \});\
            \}\
        \}\
        \
        function applyMaterialToModel() \{\
            if (!currentModel) return;\
            \
            currentModel.traverse((child) => \{\
                if (child.isMesh) \{\
                    const newMaterial = createMaterial(currentMaterialType, child.material.color, wireframeVisible);\
                    child.material = newMaterial;\
                \}\
            \});\
            \
            storeOriginalMaterials(currentModel);\
        \}\
        \
        function storeOriginalMaterials(model) \{\
            currentMaterials = [];\
            model.traverse((child) => \{\
                if (child.isMesh && child.material) \{\
                    currentMaterials.push(\{\
                        mesh: child,\
                        originalMaterial: child.material\
                    \});\
                \}\
            \});\
        \}\
        \
        function setupModel(model) \{\
            if (currentModel) \{\
                scene.remove(currentModel);\
            \}\
            \
            // Apply material\
            model.traverse((child) => \{\
                if (child.isMesh) \{\
                    const newMaterial = createMaterial(currentMaterialType, null, wireframeVisible);\
                    child.material = newMaterial;\
                \}\
            \});\
            \
            // Center model\
            const box = new THREE.Box3().setFromObject(model);\
            const center = box.getCenter(new THREE.Vector3());\
            const size = box.getSize(new THREE.Vector3());\
            \
            model.position.x = -center.x;\
            model.position.y = -center.y;\
            model.position.z = -center.z;\
            \
            currentModel = model;\
            scene.add(currentModel);\
            storeOriginalMaterials(currentModel);\
            \
            // Adjust camera\
            const maxDim = Math.max(size.x, size.y, size.z);\
            const fov = camera.fov * (Math.PI / 180);\
            let cameraZ = Math.abs(maxDim / (2 * Math.tan(fov / 2)));\
            \
            camera.position.set(0, 0, cameraZ * 1.5);\
            controls.target.set(0, 0, 0);\
            controls.update();\
            \
            showLoading(false);\
            updateStatus(`
\f1 \uc0\u10003 
\f0  Model loaded successfully!`, false);\
        \}\
        \
        // ==================== MODEL LOADING ====================\
        \
        function loadModelFromURL(url) \{\
            return new Promise((resolve, reject) => \{\
                updateStatus(`Loading model from URL...`, false);\
                showLoading(true);\
                \
                // Clear previous model\
                if (currentModel) \{\
                    scene.remove(currentModel);\
                    currentModel = null;\
                \}\
                \
                const fileExtension = url.toLowerCase().split('.').pop();\
                console.log("Loading URL:", url, "File extension:", fileExtension);\
                \
                // Handle Google Drive URLs\
                let finalUrl = url;\
                if (url.includes('drive.google.com')) \{\
                    const fileId = url.match(/[-\\w]\{25,\}/);\
                    if (fileId) \{\
                        finalUrl = `https://drive.google.com/uc?export=download&id=$\{fileId[0]\}`;\
                        console.log("Converted Google Drive URL to:", finalUrl);\
                    \}\
                \}\
                \
                if (fileExtension === 'stl' || finalUrl.includes('.stl')) \{\
                    loadSTLFromURL(finalUrl).then(resolve).catch(reject);\
                \} else if (fileExtension === 'obj' || finalUrl.includes('.obj')) \{\
                    loadOBJFromURL(finalUrl).then(resolve).catch(reject);\
                \} else \{\
                    // Default to GLTF/GLB loader\
                    loadGLBFromURL(finalUrl).then(resolve).catch(reject);\
                \}\
            \});\
        \}\
        \
        function loadGLBFromURL(url) \{\
            return new Promise((resolve, reject) => \{\
                const loader = new THREE.GLTFLoader();\
                \
                loader.load(\
                    url,\
                    function(gltf) \{\
                        const model = gltf.scene;\
                        setupModel(model);\
                        currentModelFileUrl = url;\
                        updateShareUrlDisplay();\
                        resolve(model);\
                    \},\
                    function(xhr) \{\
                        const percent = Math.round((xhr.loaded / xhr.total) * 100);\
                        document.getElementById('progress').textContent = percent + '%';\
                    \},\
                    function(error) \{\
                        console.error("GLTF load error:", error);\
                        reject(new Error("Failed to load GLB/GLTF file"));\
                    \}\
                );\
            \});\
        \}\
        \
        function loadSTLFromURL(url) \{\
            return new Promise((resolve, reject) => \{\
                const loader = new THREE.STLLoader();\
                \
                fetch(url)\
                    .then(response => \{\
                        if (!response.ok) throw new Error(`HTTP error! status: $\{response.status\}`);\
                        return response.arrayBuffer();\
                    \})\
                    .then(data => \{\
                        try \{\
                            const geometry = loader.parse(data);\
                            const material = createMaterial(currentMaterialType, null, wireframeVisible);\
                            const mesh = new THREE.Mesh(geometry, material);\
                            setupModel(mesh);\
                            currentModelFileUrl = url;\
                            updateShareUrlDisplay();\
                            resolve(mesh);\
                        \} catch (error) \{\
                            reject(new Error("Failed to parse STL file"));\
                        \}\
                    \})\
                    .catch(error => \{\
                        reject(new Error("Failed to fetch STL file"));\
                    \});\
            \});\
        \}\
        \
        function loadOBJFromURL(url) \{\
            return new Promise((resolve, reject) => \{\
                const loader = new THREE.OBJLoader();\
                \
                fetch(url)\
                    .then(response => \{\
                        if (!response.ok) throw new Error(`HTTP error! status: $\{response.status\}`);\
                        return response.text();\
                    \})\
                    .then(data => \{\
                        try \{\
                            const model = loader.parse(data);\
                            \
                            // Apply material to all meshes\
                            model.traverse((child) => \{\
                                if (child.isMesh) \{\
                                    const material = createMaterial(currentMaterialType, null, wireframeVisible);\
                                    child.material = material;\
                                \}\
                            \});\
                            \
                            setupModel(model);\
                            currentModelFileUrl = url;\
                            updateShareUrlDisplay();\
                            resolve(model);\
                        \} catch (error) \{\
                            reject(new Error("Failed to parse OBJ file"));\
                        \}\
                    \})\
                    .catch(error => \{\
                        reject(new Error("Failed to fetch OBJ file"));\
                    \});\
            \});\
        \}\
        \
        // Test model function\
        function loadTestModel() \{\
            const testUrl = "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf";\
            updateStatus("Loading test model...", false);\
            loadModelFromURL(testUrl)\
                .catch(error => \{\
                    updateStatus("Test model failed. Try loading a local file.", true);\
                \});\
        \}\
        \
        // Auto-load from URL parameters\
        window.addEventListener('load', function() \{\
            const modelUrlFromParams = getModelUrlFromParams();\
            \
            if (modelUrlFromParams) \{\
                // Enable client mode if URL has model parameter\
                enableClientMode();\
                updateStatus("Loading your model...", false);\
                \
                // Use setTimeout to ensure everything is loaded\
                setTimeout(() => \{\
                    console.log("Auto-loading model from URL:", modelUrlFromParams);\
                    loadModelFromURL(modelUrlFromParams)\
                        .then(() => \{\
                            console.log("Model loaded successfully from URL parameters");\
                        \})\
                        .catch(error => \{\
                            console.error("Failed to load model from URL:", error);\
                            updateStatus("Failed to load model from URL. Please check the link.", true);\
                        \});\
                \}, 500);\
            \} else \{\
                // Regular mode - show loading instructions\
                updateStatus("Ready to load models. Click 'Load Test Model' to start.", false);\
            \}\
            \
            updateShareUrlDisplay();\
        \});\
        \
        // ==================== EVENT LISTENERS ====================\
        \
        // Only add these event listeners in non-client mode\
        if (!isClientMode()) \{\
            document.getElementById('load-url-model').addEventListener('click', function() \{\
                const url = document.getElementById('model-url').value.trim();\
                if (url) \{\
                    loadModelFromURL(url)\
                        .catch(error => \{\
                            updateStatus(`Failed to load from URL: $\{error.message\}`, true);\
                        \});\
                \} else \{\
                    updateStatus("Please enter a valid URL", true);\
                \}\
            \});\
            \
            document.getElementById('test-model').addEventListener('click', loadTestModel);\
            \
            document.getElementById('copy-share-url').addEventListener('click', copyShareUrl);\
            document.getElementById('new-share-url').addEventListener('click', createNewShareUrl);\
            \
            document.getElementById('file-input').addEventListener('change', function(event) \{\
                const file = event.target.files[0];\
                if (file) \{\
                    loadLocalFile(file);\
                \}\
            \});\
        \}\
        \
        function loadLocalFile(file) \{\
            updateStatus("Loading local file (preview only)...", false);\
            showLoading(true);\
            \
            const reader = new FileReader();\
            const fileExtension = file.name.toLowerCase().split('.').pop();\
            const objectUrl = URL.createObjectURL(file);\
            \
            if (fileExtension === 'glb' || fileExtension === 'gltf') \{\
                const loader = new THREE.GLTFLoader();\
                loader.load(\
                    objectUrl,\
                    function(gltf) \{\
                        const model = gltf.scene;\
                        setupModel(model);\
                        // Don't set currentModelFileUrl for local files - they can't be shared\
                        updateShareUrlDisplay();\
                        URL.revokeObjectURL(objectUrl);\
                        updateStatus("
\f1 \uc0\u10003 
\f0  Local model loaded (preview only). Use cloud storage to share with clients.", false);\
                    \},\
                    function(xhr) \{\
                        const percent = Math.round((xhr.loaded / xhr.total) * 100);\
                        document.getElementById('progress').textContent = percent + '%';\
                    \},\
                    function(error) \{\
                        updateStatus(`Error loading GLB/GLTF: $\{error.message\}`, true);\
                        showLoading(false);\
                        URL.revokeObjectURL(objectUrl);\
                    \}\
                );\
            \} else if (fileExtension === 'stl') \{\
                const loader = new THREE.STLLoader();\
                reader.onload = function(e) \{\
                    try \{\
                        const geometry = loader.parse(e.target.result);\
                        const material = createMaterial(currentMaterialType, null, wireframeVisible);\
                        const mesh = new THREE.Mesh(geometry, material);\
                        setupModel(mesh);\
                        // Don't set currentModelFileUrl for local files - they can't be shared\
                        updateShareUrlDisplay();\
                        updateStatus("
\f1 \uc0\u10003 
\f0  Local model loaded (preview only). Use cloud storage to share with clients.", false);\
                    \} catch (error) \{\
                        updateStatus(`Error loading STL: $\{error.message\}`, true);\
                        showLoading(false);\
                    \}\
                    URL.revokeObjectURL(objectUrl);\
                \};\
                reader.onerror = () => \{\
                    updateStatus("Error reading STL file", true);\
                    showLoading(false);\
                    URL.revokeObjectURL(objectUrl);\
                \};\
                reader.readAsArrayBuffer(file);\
            \} else if (fileExtension === 'obj') \{\
                const loader = new THREE.OBJLoader();\
                reader.onload = function(e) \{\
                    try \{\
                        const model = loader.parse(e.target.result);\
                        model.traverse((child) => \{\
                            if (child.isMesh) \{\
                                const material = createMaterial(currentMaterialType, null, wireframeVisible);\
                                child.material = material;\
                            \}\
                        \});\
                        setupModel(model);\
                        // Don't set currentModelFileUrl for local files - they can't be shared\
                        updateShareUrlDisplay();\
                        updateStatus("
\f1 \uc0\u10003 
\f0  Local model loaded (preview only). Use cloud storage to share with clients.", false);\
                    \} catch (error) \{\
                        updateStatus(`Error loading OBJ: $\{error.message\}`, true);\
                        showLoading(false);\
                    \}\
                    URL.revokeObjectURL(objectUrl);\
                \};\
                reader.onerror = () => \{\
                    updateStatus("Error reading OBJ file", true);\
                    showLoading(false);\
                    URL.revokeObjectURL(objectUrl);\
                \};\
                reader.readAsText(file);\
            \} else \{\
                updateStatus("Unsupported file format", true);\
                showLoading(false);\
                URL.revokeObjectURL(objectUrl);\
            \}\
        \}\
        \
        // Material controls (available in both modes)\
        document.querySelectorAll('.material-btn').forEach(button => \{\
            button.addEventListener('click', function() \{\
                currentMaterialType = this.dataset.material;\
                applyMaterialToModel();\
                \
                const materialProps = document.getElementById('material-props');\
                if (currentMaterialType === 'standard' || currentMaterialType === 'phong') \{\
                    materialProps.style.display = 'block';\
                \} else \{\
                    materialProps.style.display = 'none';\
                \}\
                \
                updateStatus(`Material changed to: $\{currentMaterialType\}`, false);\
            \});\
        \});\
        \
        // Basic controls (available in both modes)\
        document.getElementById('toggle-wireframe').addEventListener('click', function() \{\
            wireframeVisible = !wireframeVisible;\
            currentMaterials.forEach(item => \{\
                if (item.mesh && item.mesh.material) \{\
                    item.mesh.material.wireframe = wireframeVisible;\
                \}\
            \});\
            this.textContent = "Wireframe: " + (wireframeVisible ? "On" : "Off");\
        \});\
        \
        document.getElementById('toggle-rotation').addEventListener('click', function() \{\
            autoRotation = !autoRotation;\
            this.textContent = "Auto Rotation: " + (autoRotation ? "On" : "Off");\
        \});\
        \
        document.getElementById('reset-view').addEventListener('click', function() \{\
            controls.reset();\
        \});\
        \
        document.getElementById('toggle-grid').addEventListener('click', function() \{\
            gridVisible = !gridVisible;\
            gridHelper.visible = gridVisible;\
            this.textContent = "Grid: " + (gridVisible ? "On" : "Off");\
        \});\
        \
        document.getElementById('toggle-axes').addEventListener('click', function() \{\
            axesVisible = !axesVisible;\
            axesHelper.visible = axesVisible;\
            this.textContent = "Axes: " + (axesVisible ? "On" : "Off");\
        \});\
        \
        // Animation loop\
        function animate() \{\
            requestAnimationFrame(animate);\
            \
            if (autoRotation && currentModel) \{\
                currentModel.rotation.y += rotationSpeed * 0.01 * rotationDirection;\
            \}\
            \
            controls.update();\
            renderer.render(scene, camera);\
        \}\
        \
        animate();\
    </script>\
</body>\
</html>}